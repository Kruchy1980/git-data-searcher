<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Git-Data-Searcher</title>
    <!-- Bookmark icon -->
    <link rel="icon" href="./bookmark-icon/github.png" type="icon/png" />
    <!-- stylesheet -->
    <link rel="stylesheet" href="./search.css" />
</head>

<body>
    <header>
        <h1>GitHub Data Searcher</h1>
    </header>
    <section id="searcher-main">
        <form action="#" id="searcher">
            <label>Who are you looking for<span id="userSearch">?</span>
          <input
            type="text"
            name="username"
            id="username"
            placeholder="Enter user GitHub login ..."
          />
        </label>
            <button id="btnGenerate">Generate</button>
            <button id="btnRepos">Repos</button>
            <button id="btnAvatar">Avatar</button>
            <button id="btnLogin">UserLogin</button>
            <button id="btnLangTry">LNG</button>
        </form>
    </section>
    <section id="display-data-main">
        <div id="user-avatar"></div>
        <div id="user-info">
            <h2>Github Data: </h2>
        </div>
        <div id="login"></div>
        <div id="github-account"></div>
        <div id="repositories"></div>
        <div id="languages"></div>
    </section>
    <script src="./search.js"></script>

    <script>
        //1. Variables
        //1.1 Main button/ Generate button
        const btnGenerate = document.querySelector('#btnGenerate');
        //1.1 avatar display
        const displayAvatar = document.querySelector('#user-avatar');
        //1.2 Repository button
        const btnRepository = document.querySelector('#btnRepos');
        //1.2 User Info
        const displayUserInfo = document.querySelector('#userInfo');
        //1.3 AvAtar button
        const btnAvatar = document.querySelector('#btnAvatar');
        //1.3 Login box
        const displayLogin = document.querySelector('#login');
        //1.4 Button Login
        const btnLogin = document.querySelector('#btnLogin');
        //1.4 Display GithubAccount
        const displayGithubAccount = document.querySelector('#github-account');
        //1.5 Button LangTry
        const btnLangTry = document.querySelector('#btnLangTry');
        //1.5 display repositories
        const displayRepositories = document.querySelector('#repositories');
        //1.6 Display languages
        const displayLanguages = document.querySelector('#languages');
        // // 1.7 DisplayArea
        // // // display div variable 1 step get 
        // const displayArea = document.querySelector('#display-data-main');
        //1.7 Username variable - changable
        let username = document.querySelector('#username');
        //1.8 form with searcher
        const searchForm = document.querySelector('#searcher');
        //2. Functions
        // 2.1 Main
        const generate = () => {
            clearDisplay();
            getAvatar();
            getUserData();
            getRepos();
            getLangAverage()
        };
        // 2.2 Get Repos
        const getRepos = async() => {
                //Repositories search
                const url = `https://api.github.com/users/${username.value}/repos?q=type:all`;

                // fetching the data variable
                const response = await fetch(url);
                // result variable jason parse response
                const result = await response.json()
                    // for check
                console.log(result);
                console.log(result.length);
                let counter = 0
                    // iterating through the repository to get specified data
                for (counter = 0; counter < result.length; counter++) {
                    console.log(result[counter].name);
                    console.log(result[counter].html_url);

                    //Display the label
                    displayRepositories.innerHTML = `<span>Repositories: </span>`;
                    //Displaly the repositories


                }
            }
            // 2.3 Get Avatar
        const getAvatar = async() => {
                // console.log(username.value);
                const url = `https://api.github.com/search/users?q=user:${username.value}`;
                // // const displayArea = document.querySelector('#display-data-main');

                const response = await fetch(url);

                const result = await response.json()
                    // console.log(result);
                result.items.forEach(item => {
                    // console.log(item.avatar_url, item.login);
                    displayAvatar.innerHTML += `<img src="${item.avatar_url}" alt="${item.login} width="50px" height="50px"/>`;
                });
            }
            // 2.4 Get userLogin
        const getUserData = async() => {
            console.log('click');
            const url = `https://api.github.com/users/${username.value}`;

            const response = await fetch(url);

            const result = await response.json();
            console.log(result);
            console.log(result.login);
            console.log(result.location);
            console.log(result.email);
            console.log(result.name);
            console.log(result.avatar_url);
            console.log(result.public_repos);
            console.log(result.repos_url);
            // result.items.forEach(item => {
            //     console.log(item.login);
            //     displayArea.innerHTML += `<div>Login: ${item.login}
            //         Page: <a href="${item.html_url}">${item.login}</a></div>
            //          `
            // });
            // <
            // span > Location < /span>: ${ result.location } <br> <
            // span > Login: < /span> ${result.login} < /
            //     div >getLangTry
            // login display
            displayLogin.innerHTML = `<span>Username: </span>`;
            displayLogin.innerHTML += `<ul><li>${result.login}</li></ul>`
                // Github account display
            displayGithubAccount.innerHTML = `<span>Github Account: </span>`
            displayGithubAccount.innerHTML += `<ul><li><a href="${result.html_url}" target="_blank">${result.html_url}</a></li></ul>`


        }
        const getLangAverage = async() => {
            const url = `https://api.github.com/users/${username.value}/repos`;

            const response = await fetch(url);

            const result = await response.json();
            // Counter of elements to display
            let counter = 0;
            // languages calculation
            let count = {};
            result.map(el => count[el.language] = (count[el.language] || 0) + 1);
            // Keywords extraction
            for (key in count) {
                if (count.hasOwnProperty(key)) {
                    // extracting languages names
                    const language = Object.keys(count).join(',');
                    // extracting languages values
                    const langValues = Object.values(count);
                    //creatihg array with keywords
                    const langArray = language.split(',');
                    // Creating an array of percentage usage of languages
                    let langPercentage = Array.from(langValues, el => Math.round((el / result.length) * 100) + '%');
                    console.log(langPercentage);
                    console.log(langArray);
                    console.log(counter);
                    // language display
                    displayLanguages.innerHTML = `<span>Languages:</span>`
                    for (counter = 0; counter < langArray.length; counter++) {
                        displayLanguages.innerHTML += `<ul><li>${langArray[counter]=== 'null' ? 'No Data' : langArray[counter] }: ${langPercentage[counter]}</li></ul>`
                    }
                }
            }
        }


        // Clearing Display if new request
        const clearDisplay = () => {
                if (displayArea.innerHTML) {
                    displayArea.innerHTML = '';
                }
            }
            //3. EventListeners
            //3.1 Main/Generate button
        btnGenerate.addEventListener('click', generate);
        //3.2 Get repos on btnRepos click
        btnRepos.addEventListener('click', getRepos);
        //3.3 Get avatar
        btnAvatar.addEventListener('click', getAvatar);
        //3.4 Get userLogin
        btnLogin.addEventListener('click', getUserData);
        //3.5 getLangTry
        btnLangTry.addEventListener('click', getLangAverage);
        // // disarm the username searcher form
        searchForm.addEventListener('submit', (event) => {
            event.preventDefault();
            // console.log(username.value);
        })
    </script>
</body>

</html>